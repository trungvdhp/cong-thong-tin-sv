@using Kendo.Mvc.UI;
@using CongThongTinSV.Models;
@{
    ViewBag.Title = "InDanhSachLop";
}


@*@Html.Label("NamHoc", "Năm học:")*@
@(Html.Kendo().DropDownList()
    .Name("NamHoc")
    //.Placeholder("Chọn năm học")
    .OptionLabel("Chọn năm học")
    .DataTextField("Text")
    .DataValueField("Value")
    //.SelectedIndex(0)
    .DataSource(source =>
    {
        source.Read(read =>
        {
            read.Action("GetNamHoc", "JSON");
        }).ServerFiltering(true);
    })
)

@*@Html.Label("HocKy", "Học kỳ:")*@
@(Html.Kendo().DropDownList()
    .Name("HocKy")
    .OptionLabel("Chọn học kỳ")
    .DataTextField("Text")
    .DataValueField("Value")
    .DataSource(source =>
    {
        source.Read(read =>
        {
            read.Action("GetHocKy", "JSON")
                .Data("filterHocKy");
        }).ServerFiltering(true);
    })
    .Enable(false)
    .AutoBind(false)
        .CascadeFrom("NamHoc")
)
@*@Html.Label("DotHoc", "Đợt học:")*@
@(Html.Kendo().DropDownList()
    .Name("DotHoc")
    .OptionLabel("Chọn đợt học")
    .DataTextField("Text")
    .DataValueField("Value")
    .DataSource(source =>
    {
        source.Read(read =>
        {
            read.Action("GetDotHoc", "JSON")
                .Data("filterDotHoc");
        }).ServerFiltering(true);
    })
    .Enable(false)
    .AutoBind(false)
        .CascadeFrom("HocKy")
)
@*@Html.Label("HeDT", "Hệ đào tạo:")*@
@(Html.Kendo().DropDownList()
    .Name("HeDT")
    .OptionLabel("Chọn hệ đào tạo")
    .DataTextField("Text")
    .DataValueField("Value")
        .SelectedIndex(0)
    .DataSource(source =>
    {
        source.Read(read =>
        {
            read.Action("GetHeDT", "JSON");
        }).ServerFiltering(true);
    })
    .CascadeFrom("DotHoc")
)
@*@Html.Label("Khoa", "Khoa:")*@
@(Html.Kendo().DropDownList()
    .Name("Khoa")
    .OptionLabel("Chọn khoa")
    .DataTextField("Text")
    .DataValueField("Value")
        .SelectedIndex(0)
    .DataSource(source =>
    {
        source.Read(read =>
        {
            read.Action("GetKhoa", "JSON");
        }).ServerFiltering(true);
    })
    .CascadeFrom("HeDT")
)
@*@Html.Label("KhoaHoc", "Khóa:")*@
@(Html.Kendo().DropDownList()
    .Name("KhoaHoc")
    .OptionLabel("Chọn khóa học")
    .DataTextField("Text")
    .DataValueField("Value")
        .SelectedIndex(0)
    .DataSource(source =>
    {
        source.Read(read =>
        {
            read.Action("GetKhoaHoc", "JSON");
        }).ServerFiltering(true);
    })
    .CascadeFrom("Khoa")
)
@*@Html.Label("LopTC", "Danh sách lớp học phần:")*@
@(Html.Kendo().DropDownList()
    .Name("LopTC")
    .OptionLabel("Chọn lớp học phần")
    .DataTextField("Text")
    .DataValueField("Value")
        //.SelectedIndex(0)
    .DataSource(source =>
    {
        source.Read(read =>
        {
            read.Action("GetLopTC", "JSON")
                .Data("filterLopTC");
        }).ServerFiltering(true);
    })
    .Enable(false)
    .AutoBind(false)
        .CascadeFrom("KhoaHoc")
    .Events(e=>{
        e.Change("loadGridSinhVien");
    })
)
@(Html.Kendo().Grid<CongThongTinSV.Models.SinhVien>()
    .Name("GridSinhVien")
    .Columns(columns => {
        columns.Bound(sv => sv.ID_sv).Groupable(false);
        columns.Bound(sv => sv.Ma_sv);
        columns.Bound(sv => sv.Ho_ten);
        columns.Bound(sv => sv.Lop);
    })
    .Pageable()
    .Sortable()
    .Filterable()
    .Scrollable()
    .Groupable()
    .DataSource(
        dataSource => dataSource
            .Ajax()
            .Read(read => read.Action("GetSinhVienLopTC", "JSON").Data("filterGrid"))
            
    )
)

<script type="text/javascript">
    function filterHocKy() {
        return {
            NamHoc: $("#NamHoc").val()
        }
    }
    function filterDotHoc() {
        return {
            NamHoc: $("#NamHoc").val(),
            HocKy: $("#HocKy").val()
        }
    }
    function filterGrid() {
        return {
            ID_lop_tc: $("#LopTC").val()
        }
    }
    function filterLopTC() {
        return {
            Ky_dang_ky: $("#DotHoc").val(),
            ID_khoa: $("#Khoa").val(),
            ID_he: $("#HeDT").val(),
            Khoa_hoc: $("#KhoaHoc").val(),
        }
    }
    function loadGridSinhVien() {
        $("#GridSinhVien").data("kendoGrid").dataSource.read();
    }
</script>