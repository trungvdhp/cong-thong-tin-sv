@using Kendo.Mvc.UI;
@using CongThongTinSV.Models;
@{
    ViewBag.Title = ViewBag.CourseName + " : Bảng điểm các bài thi trắc nghiệm";
}
<div>
<h2>@ViewBag.Title</h2>
@{
    if(ViewBag.Error != "")
    {
        <h2 class="error">Lỗi: @ViewBag.Error</h2>
    }
    else
    {
        @(Html.Kendo().Grid<CongThongTinSV.Models.MoodleStudentQuizGrade>()
            .Name("Grid")
            .Columns(columns =>
            {
                columns.Bound(c => c.ID).Title("Bài kiểm tra")
                    .ClientTemplate("<a href=#=Url#>#=QuizName#</a>").HtmlAttributes(new { title = "Tới trang làm bài" })
                    .Width(500);
                columns.Bound(c => c.Grade)
                    .Width(70)
                    .ClientTemplate(
                    "# if (Grade != null) { #" +
                        (@Html.ActionLink("#= kendo.toString(Grade, '0.0') #", "MyQuizStudentGrade", "MoodleQuiz", new { quizid = "QuizID" }, new { title = "Xem bảng điểm chi tiết" })).ToHtmlString().Replace("QuizID", "#=ID#") +
                    "# } #");
                columns.Bound(c => c.Grade)
                    .Title("Xem")
                    .ClientTemplate(
                    "# if (Grade != null) { #" +
                        (@Html.ActionLink("Xem lại bài làm", "MyQuizReview", "MoodleQuiz", new { quizid = "QuizID" }, null)).ToHtmlString().Replace("QuizID", "#=ID#") +
                       "# } #");
            })
            .Pageable(pager => pager.PageSizes(new int[] { 5, 10, 20, 50 }).Refresh(true).Input(true).Numeric(false).Messages(m =>{ m.ItemsPerPage("dòng mỗi trang"); m.First("Trang đầu tiên"); m.Last("Trang cuối cùng"); m.Next("Trang sau"); m.Previous("Trang trước"); m.Refresh("Làm mới");}))
            .Sortable(s => s.SortMode(GridSortMode.SingleColumn))
            .Filterable()
            .Scrollable()
            //.Groupable()
            .Resizable(r => r.Columns(true))
            .Reorderable(ro => ro.Columns(true))
            .Navigatable()
            //.HtmlAttributes(new { style = "height:auto" })
            //.ColumnMenu(menu => menu.Enabled(true).Sortable(false))
            //.Selectable(s => s.Mode(GridSelectionMode.Single))
            .DataSource(
                dataSource => dataSource
                    .Ajax()
                    .Read(read => read.Action("GetMyQuizGrades", "MoodleQuiz", new { courseid = ViewBag.CourseID }))
                    .PageSize(50)
            )
            .Events(e => e.DataBound("onDataBound"))
        );
    }
}
</div>
<div style="text-align: center;margin-top: 10px;">
    <button class="k-button" type="submit" onclick="pageback()">Quay về danh sách các khóa học</button>
</div>
<script type="text/javascript">
    function onDataBound(e) {
        resizeGrid("#Grid");
    }
</script>